<div class="container2">
  <h1 class="titulo-transaccion">Dep칩sito</h1>

  <div class="saldo">
    Saldo Actual: $<span id="balance">{{formatCLP saldo}}</span>
  </div>

  <div class="card-transaccion">
    <form id="transactionForm">
      <label for="amount">Ingrese la cantidad de dinero a depositar:</label>
      <input type="number" id="amount" name="amount" placeholder="$0.00" required min="1" step="1" />
      <button type="submit" class="submit-btn2">Confirme monto y comience a jugar</button>
    </form>
  </div>

  <div class="card-transaccion">
    <form id="withdrawForm">
      <label for="amount2">Ingrese la cantidad de dinero que desea retirar:</label>
      <input type="number" id="amount2" name="amount2" placeholder="$0.00" required min="1" step="1" />
      <button type="submit" class="submit-btn2">Confirme monto y retire su dinero</button>
    </form>
  </div>
</div>

<script>
  const fmtCLP = v => new Intl.NumberFormat('es-CL', {
    style: 'decimal',
    maximumFractionDigits: 0
  }).format(Number(v ?? 0));

  // --- DEP칍SITO ---
  document.getElementById('transactionForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const amount = parseFloat(document.getElementById('amount').value);
    if (isNaN(amount) || amount <= 0) return alert("Monto inv치lido");

    const res = await fetch('/depositar', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ amount })
    });

    const data = await res.json();
    if (data.nuevoSaldo !== undefined) {
      document.getElementById('balance').textContent = fmtCLP(data.nuevoSaldo);
      alert("Dep칩sito exitoso 游눯");
      document.getElementById('amount').value = '';
    } else {
      alert(data.error || "Error al depositar");
    }
  });

  // --- RETIRO ---
  document.getElementById('withdrawForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const amount2 = parseFloat(document.getElementById('amount2').value);
    if (isNaN(amount2) || amount2 <= 0) return alert("Monto inv치lido");

    const res = await fetch('/retirar', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ amount: amount2 })
    });

    const data = await res.json();
    if (data.nuevoSaldo !== undefined) {
      document.getElementById('balance').textContent = fmtCLP(data.nuevoSaldo);
      alert("Retiro exitoso 游낁");
      document.getElementById('amount2').value = '';
    } else {
      alert(data.error || "Error al retirar");
    }
  });
</script>